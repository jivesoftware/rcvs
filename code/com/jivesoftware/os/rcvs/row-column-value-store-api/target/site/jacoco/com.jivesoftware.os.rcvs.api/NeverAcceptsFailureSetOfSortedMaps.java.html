<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>NeverAcceptsFailureSetOfSortedMaps.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">row-column-value-store-api</a> &gt; <a href="index.html" class="el_package">com.jivesoftware.os.rcvs.api</a> &gt; <span class="el_source">NeverAcceptsFailureSetOfSortedMaps.java</span></div><h1>NeverAcceptsFailureSetOfSortedMaps.java</h1><pre class="source lang-java linenums">/*
 * Copyright 2013 Jive Software, Inc
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may not
 * use this file except in compliance with the License. You may obtain a copy of
 * the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
 * License for the specific language governing permissions and limitations under
 * the License.
 */
package com.jivesoftware.os.rcvs.api;

import com.jivesoftware.os.jive.utils.base.interfaces.CallbackStream;
import com.jivesoftware.os.jive.utils.logger.MetricLogger;
import com.jivesoftware.os.jive.utils.logger.MetricLoggerFactory;
import com.jivesoftware.os.rcvs.api.timestamper.Timestamper;
import java.util.List;
import java.util.Map;

public class NeverAcceptsFailureSetOfSortedMaps&lt;T, R, C, V&gt; implements RowColumnValueStore&lt;T, R, C, V, RuntimeException&gt; {

<span class="nc" id="L27">    private static final MetricLogger LOG = MetricLoggerFactory.getLogger();</span>
    private final RowColumnValueStore&lt;T, R, C, V, ?&gt; store;
    private final ThunderingHerd thunderingHerd;

<span class="nc" id="L31">    public NeverAcceptsFailureSetOfSortedMaps(RowColumnValueStore&lt;T, R, C, V, ?&gt; store) {</span>
<span class="nc" id="L32">        this.store = store;</span>
<span class="nc" id="L33">        this.thunderingHerd = new ThunderingHerd();</span>
<span class="nc" id="L34">    }</span>

    @Override
    public void add(T tenantId, R rowKey, C columnKey, V columnValue, Integer timeToLiveInSeconds, Timestamper overrideTimestamper) {
        while (true) {
            try {
<span class="nc" id="L40">                thunderingHerd.herd();</span>
<span class="nc" id="L41">                store.add(tenantId, rowKey, columnKey, columnValue, timeToLiveInSeconds, overrideTimestamper);</span>
                return;
<span class="nc" id="L43">            } catch (Exception x) {</span>
<span class="nc" id="L44">                thunderingHerd.pushback();</span>
            } finally {
<span class="nc" id="L46">                thunderingHerd.progress();</span>
<span class="nc" id="L47">            }</span>
        }
    }

    @Override
    public boolean addIfNotExists(T tenantId, R rowKey, C columnKey, V columnValue, Integer timeToLiveInSeconds, Timestamper overrideTimestamper) {
        while (true) {
            try {
<span class="nc" id="L55">                thunderingHerd.herd();</span>
<span class="nc" id="L56">                return store.addIfNotExists(tenantId, rowKey, columnKey, columnValue, timeToLiveInSeconds, overrideTimestamper);</span>
<span class="nc" id="L57">            } catch (Exception x) {</span>
<span class="nc" id="L58">                thunderingHerd.pushback();</span>
            } finally {
<span class="nc" id="L60">                thunderingHerd.progress();</span>
<span class="nc" id="L61">            }</span>
        }
    }

    @Override
    public boolean replaceIfEqualToExpected(T tenantId, R rowKey, C columnKey, V columnValue, V expectedValue, Integer timeToLiveInSeconds,
        Timestamper overrideTimestamper) throws RuntimeException {
        while (true) {
            try {
<span class="nc" id="L70">                thunderingHerd.herd();</span>
<span class="nc" id="L71">                return store.replaceIfEqualToExpected(tenantId, rowKey, columnKey, columnValue, expectedValue, timeToLiveInSeconds, overrideTimestamper);</span>
<span class="nc" id="L72">            } catch (Exception x) {</span>
<span class="nc" id="L73">                thunderingHerd.pushback();</span>
            } finally {
<span class="nc" id="L75">                thunderingHerd.progress();</span>
<span class="nc" id="L76">            }</span>
        }
    }

    @Override
    public void multiAdd(T tenantId, R rowKey, C[] columnKeys, V[] columnValues, Integer timeToLiveInSeconds, Timestamper overrideTimestamper) {
        while (true) {
            try {
<span class="nc" id="L84">                thunderingHerd.herd();</span>
<span class="nc" id="L85">                store.multiAdd(tenantId, rowKey, columnKeys, columnValues, timeToLiveInSeconds, overrideTimestamper);</span>
                return;
<span class="nc" id="L87">            } catch (Exception x) {</span>
<span class="nc" id="L88">                thunderingHerd.pushback();</span>
            } finally {
<span class="nc" id="L90">                thunderingHerd.progress();</span>
<span class="nc" id="L91">            }</span>
        }
    }

    @Override
    public void multiRowsMultiAdd(T tenantId, List&lt;RowColumValueTimestampAdd&lt;R, C, V&gt;&gt; multiAdd) {
        while (true) {
            try {
<span class="nc" id="L99">                thunderingHerd.herd();</span>
<span class="nc" id="L100">                store.multiRowsMultiAdd(tenantId, multiAdd);</span>
                return;
<span class="nc" id="L102">            } catch (Exception x) {</span>
<span class="nc" id="L103">                thunderingHerd.pushback();</span>
            } finally {
<span class="nc" id="L105">                thunderingHerd.progress();</span>
<span class="nc" id="L106">            }</span>
        }
    }

    @Override
    public void multiRowsMultiAdd(List&lt;TenantRowColumValueTimestampAdd&lt;T, R, C, V&gt;&gt; multiAdd) {
        while (true) {
            try {
<span class="nc" id="L114">                thunderingHerd.herd();</span>
<span class="nc" id="L115">                store.multiRowsMultiAdd(multiAdd);</span>
                return;
<span class="nc" id="L117">            } catch (Exception x) {</span>
<span class="nc" id="L118">                thunderingHerd.pushback();</span>
            } finally {
<span class="nc" id="L120">                thunderingHerd.progress();</span>
<span class="nc" id="L121">            }</span>
        }
    }

    @Override
    public V get(T tenantId, R rowKey, C key, Integer overrideNumberOfRetries, Integer overrideConsistency) {
        while (true) {
            try {
<span class="nc" id="L129">                thunderingHerd.herd();</span>
<span class="nc" id="L130">                return store.get(tenantId, rowKey, key, overrideNumberOfRetries, overrideConsistency);</span>
<span class="nc" id="L131">            } catch (Exception x) {</span>
<span class="nc" id="L132">                thunderingHerd.pushback();</span>
            } finally {
<span class="nc" id="L134">                thunderingHerd.progress();</span>
<span class="nc" id="L135">            }</span>
        }
    }

    @Override
    public List&lt;V&gt; multiGet(T tenantId, R rowKey, C[] keys, Integer overrideNumberOfRetries, Integer overrideConsistency) {
        while (true) {
            try {
<span class="nc" id="L143">                thunderingHerd.herd();</span>
<span class="nc" id="L144">                return store.multiGet(tenantId, rowKey, keys, overrideNumberOfRetries, overrideConsistency);</span>
<span class="nc" id="L145">            } catch (Exception x) {</span>
<span class="nc" id="L146">                thunderingHerd.pushback();</span>
            } finally {
<span class="nc" id="L148">                thunderingHerd.progress();</span>
<span class="nc" id="L149">            }</span>
        }
    }

    @Override
    public ColumnValueAndTimestamp&lt;C, V, Long&gt;[] multiGetEntries(
        T tenantId, R rowKey, C[] columnKeys, Integer overrideNumberOfRetries, Integer overrideConsistency) {
        while (true) {
            try {
<span class="nc" id="L158">                thunderingHerd.herd();</span>
<span class="nc" id="L159">                return store.multiGetEntries(tenantId, rowKey, columnKeys, overrideNumberOfRetries, overrideConsistency);</span>
<span class="nc" id="L160">            } catch (Exception x) {</span>
<span class="nc" id="L161">                thunderingHerd.pushback();</span>
            } finally {
<span class="nc" id="L163">                thunderingHerd.progress();</span>
<span class="nc" id="L164">            }</span>
        }
    }

    @Override
    public void remove(T tenantId, R rowKey, C key, Timestamper overrideTimestamper) {
        while (true) {
            try {
<span class="nc" id="L172">                thunderingHerd.herd();</span>
<span class="nc" id="L173">                store.remove(tenantId, rowKey, key, overrideTimestamper);</span>
                return;
<span class="nc" id="L175">            } catch (Exception x) {</span>
<span class="nc" id="L176">                thunderingHerd.pushback();</span>
            } finally {
<span class="nc" id="L178">                thunderingHerd.progress();</span>
<span class="nc" id="L179">            }</span>
        }
    }

    @Override
    public void multiRemove(T tenantId, R rowKey, C[] key, Timestamper overrideTimestamper) {
        while (true) {
            try {
<span class="nc" id="L187">                thunderingHerd.herd();</span>
<span class="nc" id="L188">                store.multiRemove(tenantId, rowKey, key, overrideTimestamper);</span>
                return;
<span class="nc" id="L190">            } catch (Exception x) {</span>
<span class="nc" id="L191">                thunderingHerd.pushback();</span>
            } finally {
<span class="nc" id="L193">                thunderingHerd.progress();</span>
<span class="nc" id="L194">            }</span>
        }
    }

    @Override
    public void multiRowsMultiRemove(T tenantId, List&lt;RowColumnTimestampRemove&lt;R, C&gt;&gt; multiRemove) {
        while (true) {
            try {
<span class="nc" id="L202">                thunderingHerd.herd();</span>
<span class="nc" id="L203">                store.multiRowsMultiRemove(tenantId, multiRemove);</span>
                return;
<span class="nc" id="L205">            } catch (Exception x) {</span>
<span class="nc" id="L206">                thunderingHerd.pushback();</span>
            } finally {
<span class="nc" id="L208">                thunderingHerd.progress();</span>
<span class="nc" id="L209">            }</span>
        }
    }

    @Override
    public void multiRowsMultiRemove(List&lt;TenantRowColumnTimestampRemove&lt;T, R, C&gt;&gt; multiRemove) {
        while (true) {
            try {
<span class="nc" id="L217">                thunderingHerd.herd();</span>
<span class="nc" id="L218">                store.multiRowsMultiRemove(multiRemove);</span>
                return;
<span class="nc" id="L220">            } catch (Exception x) {</span>
<span class="nc" id="L221">                thunderingHerd.pushback();</span>
            } finally {
<span class="nc" id="L223">                thunderingHerd.progress();</span>
<span class="nc" id="L224">            }</span>
        }
    }

    @Override
    public void getKeys(T tenantId, R rowKey, C start, Long maxCount, int batchSize,
        boolean reversed, Integer overrideNumberOfRetries, Integer overrideConsistency, CallbackStream&lt;C&gt; callback) {
        while (true) {
            try {
<span class="nc" id="L233">                thunderingHerd.herd();</span>
<span class="nc" id="L234">                store.getKeys(tenantId, rowKey, start, maxCount, batchSize, reversed, overrideNumberOfRetries, overrideConsistency, callback);</span>
                return;
<span class="nc" id="L236">            } catch (CallbackStreamException cex) {</span>
<span class="nc" id="L237">                throw cex;</span>
<span class="nc" id="L238">            } catch (Exception x) {</span>
<span class="nc" id="L239">                thunderingHerd.pushback();</span>
            } finally {
<span class="nc" id="L241">                thunderingHerd.progress();</span>
<span class="nc" id="L242">            }</span>
        }
    }

    @Override
    public void getValues(T tenantId, R rowKey, C start, Long maxCount, int batchSize,
        boolean reversed, Integer overrideNumberOfRetries, Integer overrideConsistency, CallbackStream&lt;V&gt; callback) {
        while (true) {
            try {
<span class="nc" id="L251">                thunderingHerd.herd();</span>
<span class="nc" id="L252">                store.getValues(tenantId, rowKey, start, maxCount, batchSize, reversed, overrideNumberOfRetries, overrideConsistency, callback);</span>
                return;
<span class="nc" id="L254">            } catch (CallbackStreamException cex) {</span>
<span class="nc" id="L255">                throw cex;</span>
<span class="nc" id="L256">            } catch (Exception x) {</span>
<span class="nc" id="L257">                thunderingHerd.pushback();</span>
            } finally {
<span class="nc" id="L259">                thunderingHerd.progress();</span>
<span class="nc" id="L260">            }</span>
        }
    }

    @Override
    public &lt;TS&gt; void getEntrys(T tenantId, R rowKey, C start, Long maxCount, int batchSize,
        boolean reversed, Integer overrideNumberOfRetries, Integer overrideConsistency, CallbackStream&lt;ColumnValueAndTimestamp&lt;C, V, TS&gt;&gt; callback) {
        while (true) {
            try {
<span class="nc" id="L269">                thunderingHerd.herd();</span>
<span class="nc" id="L270">                store.getEntrys(tenantId, rowKey, start, maxCount, batchSize, reversed, overrideNumberOfRetries, overrideConsistency, callback);</span>
                return;
<span class="nc" id="L272">            } catch (CallbackStreamException cex) {</span>
<span class="nc" id="L273">                throw cex;</span>
<span class="nc" id="L274">            } catch (Exception x) {</span>
<span class="nc" id="L275">                thunderingHerd.pushback();</span>
            } finally {
<span class="nc" id="L277">                thunderingHerd.progress();</span>
<span class="nc" id="L278">            }</span>
        }
    }

    @Override
    public void getAllRowKeys(int batchSize, Integer overrideNumberOfRetries, CallbackStream&lt;TenantIdAndRow&lt;T, R&gt;&gt; callback) {
        while (true) {
            try {
<span class="nc" id="L286">                thunderingHerd.herd();</span>
<span class="nc" id="L287">                store.getAllRowKeys(batchSize, overrideNumberOfRetries, callback);</span>
                return;
<span class="nc" id="L289">            } catch (CallbackStreamException cex) {</span>
<span class="nc" id="L290">                throw cex;</span>
<span class="nc" id="L291">            } catch (Exception x) {</span>
<span class="nc" id="L292">                thunderingHerd.pushback();</span>
            } finally {
<span class="nc" id="L294">                thunderingHerd.progress();</span>
<span class="nc" id="L295">            }</span>
        }
    }

    @Override
    public void getRowKeys(T tenantId, R startRowKey, R stopRowKey, int batchSize, Integer overrideNumberOfRetries,
        CallbackStream&lt;TenantIdAndRow&lt;T, R&gt;&gt; callback) {
        while (true) {
            try {
<span class="nc" id="L304">                thunderingHerd.herd();</span>
<span class="nc" id="L305">                store.getRowKeys(tenantId, startRowKey, stopRowKey, batchSize, overrideNumberOfRetries, callback);</span>
                return;
<span class="nc" id="L307">            } catch (CallbackStreamException cex) {</span>
<span class="nc" id="L308">                throw cex;</span>
<span class="nc" id="L309">            } catch (Exception x) {</span>
<span class="nc" id="L310">                thunderingHerd.pushback();</span>
            } finally {
<span class="nc" id="L312">                thunderingHerd.progress();</span>
<span class="nc" id="L313">            }</span>
        }
    }

    @Override
    public void removeRow(T tenantId, R rowKey, Timestamper overrideTimestamper) {
        while (true) {
            try {
<span class="nc" id="L321">                thunderingHerd.herd();</span>
<span class="nc" id="L322">                store.removeRow(tenantId, rowKey, overrideTimestamper);</span>
                return;
<span class="nc" id="L324">            } catch (Exception x) {</span>
<span class="nc" id="L325">                thunderingHerd.pushback();</span>
            } finally {
<span class="nc" id="L327">                thunderingHerd.progress();</span>
<span class="nc" id="L328">            }</span>
        }
    }

    @Override
    public List&lt;V&gt; multiRowGet(T tenantId, List&lt;R&gt; rowKeys, C columnKey, Integer overrideNumberOfRetries, Integer overrideConsistency) {
        while (true) {
            try {
<span class="nc" id="L336">                thunderingHerd.herd();</span>
<span class="nc" id="L337">                return store.multiRowGet(tenantId, rowKeys, columnKey, overrideNumberOfRetries, overrideConsistency);</span>
<span class="nc" id="L338">            } catch (Exception x) {</span>
<span class="nc" id="L339">                thunderingHerd.pushback();</span>
            } finally {
<span class="nc" id="L341">                thunderingHerd.progress();</span>
<span class="nc" id="L342">            }</span>
        }
    }

    @Override
    public List&lt;Map&lt;C, V&gt;&gt; multiRowMultiGet(T tenantId, List&lt;R&gt; rowKeys, List&lt;C&gt; columnKeys, Integer overrideNumberOfRetries, Integer overrideConsistency)
        throws RuntimeException {
        while (true) {
            try {
<span class="nc" id="L351">                thunderingHerd.herd();</span>
<span class="nc" id="L352">                return store.multiRowMultiGet(tenantId, rowKeys, columnKeys, overrideNumberOfRetries, overrideConsistency);</span>
<span class="nc" id="L353">            } catch (Exception x) {</span>
<span class="nc" id="L354">                thunderingHerd.pushback();</span>
            } finally {
<span class="nc" id="L356">                thunderingHerd.progress();</span>
<span class="nc" id="L357">            }</span>
        }
    }

    @Override
    public &lt;TS&gt; void multiRowGetAll(T tenantId, List&lt;KeyedColumnValueCallbackStream&lt;R, C, V, TS&gt;&gt; rowKeyCallbackStreamPairs) {
        while (true) {
            try {
<span class="nc" id="L365">                thunderingHerd.herd();</span>
<span class="nc" id="L366">                store.multiRowGetAll(tenantId, rowKeyCallbackStreamPairs);</span>
                return;
<span class="nc" id="L368">            } catch (CallbackStreamException cex) {</span>
<span class="nc" id="L369">                throw cex;</span>
<span class="nc" id="L370">            } catch (Exception x) {</span>
<span class="nc" id="L371">                thunderingHerd.pushback();</span>
            } finally {
<span class="nc" id="L373">                thunderingHerd.progress();</span>
<span class="nc" id="L374">            }</span>
        }
    }

    @Override
    public &lt;TS&gt; void multiRowGetAll(List&lt;TenantKeyedColumnValueCallbackStream&lt;T, R, C, V, TS&gt;&gt; tenantRowKeyCallbackStreamPairs) {
        while (true) {
            try {
<span class="nc" id="L382">                thunderingHerd.herd();</span>
<span class="nc" id="L383">                store.multiRowGetAll(tenantRowKeyCallbackStreamPairs);</span>
                return;
<span class="nc" id="L385">            } catch (CallbackStreamException cex) {</span>
<span class="nc" id="L386">                throw cex;</span>
<span class="nc" id="L387">            } catch (Exception x) {</span>
<span class="nc" id="L388">                thunderingHerd.pushback();</span>
            } finally {
<span class="nc" id="L390">                thunderingHerd.progress();</span>
<span class="nc" id="L391">            }</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.3.201306030806</span></div></body></html>